<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdsEngineer Customer Portal</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem 0; text-align: center; }
        .header h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
        
        .login-form { background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); max-width: 400px; margin: 3rem auto; }
        .login-form h2 { margin-bottom: 1.5rem; color: #333; }
        
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-group input { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 5px; font-size: 16px; transition: border-color 0.3s ease; }
        .form-group input:focus { outline: none; border-color: #667eea; }
        
        .btn-primary { background: #667eea; color: white; padding: 12px 24px; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; transition: background 0.3s ease; width: 100%; }
        .btn-primary:hover { background: #5a6fd8; }
        
        .dashboard { display: none; }
        .dashboard-header { background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .dashboard-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
        .stat-value { font-size: 2rem; font-weight: 700; color: #667eea; margin-bottom: 0.5rem; }
        .stat-label { color: #6c757d; }
        
        .error-message { color: #dc3545; margin-top: 10px; padding: 10px; background: #f8d7da; border-radius: 5px; display: none; }
        .success-message { color: #155724; margin-top: 10px; padding: 10px; background: #d4edda; border-radius: 5px; display: none; }
        
        .loading { text-align: center; padding: 20px; }
        .loading::after { content: "..."; animation: dots 1.5s steps(4, end) infinite; }
        @keyframes dots { 0%, 20% { content: "."; } 40% { content: ".."; } 60% { content: "..."; } 80%, 100% { content: ""; } }
    </style>
</head>
<body>

<header class="header">
    <h1>AdsEngineer Customer Portal</h1>
    <p>Track your conversion attribution and manage your account</p>
</header>

<!-- Login Form -->
<div id="login-section" class="login-form">
    <h2>Sign In to Your Account</h2>
    <form id="login-form">
        <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" id="email" name="email" placeholder="your@email.com" required>
        </div>
        
        <div class="form-group">
            <label for="api-key">API Key</label>
            <input type="password" id="api-key" name="api-key" placeholder="Your AdsEngineer API key" required>
        </div>
        
        <button type="submit" class="btn-primary">Sign In</button>
        
        <div class="error-message" id="error-message"></div>
        <div class="success-message" id="success-message"></div>
    </form>
    
    <p style="text-align: center; margin-top: 1rem; color: #6c757d;">
        Don't have an account? <a href="/" style="color: #667eea;">Start your free trial</a>
    </p>
</div>

<!-- Dashboard -->
<div id="dashboard-section" class="dashboard" style="display: none;">
    <div class="dashboard-header">
        <h2>Welcome to Your Dashboard</h2>
        <p>Track your conversion attribution and see which keywords are driving sales</p>
    </div>
    
    <div class="dashboard-stats">
        <div class="stat-card">
            <div class="stat-value" id="total-conversions">0</div>
            <div class="stat-label">Total Conversions</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value" id="total-revenue">$0</div>
            <div class="stat-label">Total Revenue</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value" id="avg-order-value">$0</div>
            <div class="stat-label">Avg Order Value</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value" id="roas">0x</div>
            <div class="stat-label">Return on Ad Spend</div>
        </div>
    </div>
    
    <div style="text-align: center; margin-top: 2rem;">
        <button onclick="logout()" class="btn-primary" style="background: #6c757d;">Sign Out</button>
    </div>
</div>

<script>
    // Customer portal functionality
    let currentUser = null;
    let apiKey = null;
    
    // Handle login form submission
    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const apiKeyInput = document.getElementById('api-key').value;
        
        if (!email || !apiKeyInput) {
            showError('Please fill in all fields');
            return;
        }
        
        try {
            // Test API connection
            const response = await fetch('https://adsengineer-cloud.adsengineer.workers.dev/api/v1/customer/profile', {
                headers: {
                    'Authorization': `Bearer ${apiKeyInput}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.ok) {
                const userData = await response.json();
                currentUser = userData;
                apiKey = apiKeyInput;
                showDashboard();
                loadDashboardData();
            } else {
                showError('Invalid API key or account not found');
            }
        } catch (error) {
            console.error('Login error:', error);
            showError('Connection failed. Please check your API key.');
        }
    });
    
    function showDashboard() {
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('dashboard-section').style.display = 'block';
    }
    
    function logout() {
        currentUser = null;
        apiKey = null;
        document.getElementById('login-section').style.display = 'block';
        document.getElementById('dashboard-section').style.display = 'none';
        document.getElementById('login-form').reset();
    }
    
    function showError(message) {
        const errorDiv = document.getElementById('error-message');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        setTimeout(() => errorDiv.style.display = 'none', 5000);
    }
    
    function showSuccess(message) {
        const successDiv = document.getElementById('success-message');
        successDiv.textContent = message;
        successDiv.style.display = 'block';
        setTimeout(() => successDiv.style.display = 'none', 5000);
    }
    
    async function loadDashboardData() {
        // This would connect to your API and load real customer data
        // For now, we'll show demo data
        
        document.getElementById('total-conversions').textContent = '247';
        document.getElementById('total-revenue').textContent = '$31,247';
        document.getElementById('avg-order-value').textContent = '$127';
        document.getElementById('roas').textContent = '3.2x';
        
        // Add more detailed dashboard loading here
        // This would connect to your billing API and show real customer data
    }
</script>

</body>
</html>