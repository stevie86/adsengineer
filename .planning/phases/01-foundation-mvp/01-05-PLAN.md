---
wave: 5
depends_on:
  - 01-01-PLAN.md
  - 01-04-PLAN.md
files_modified:
  - frontend/src/pages/OnboardingWizard.tsx
  - frontend/src/components/OnboardingStepper.tsx
  - frontend/src/pages/SnippetPage.tsx
  - frontend/src/components/TrackingSnippet.tsx
  - frontend/src/pages/PlatformConnect.tsx
  - serverless/src/routes/onboarding.ts
autonomous: true
---

# Plan 05: Onboarding Wizard

**Objective:** Create multi-step onboarding wizard with site setup, tracking snippet display, installation verification, and Google Ads OAuth connection.

## must_haves

- [ ] Site setup wizard allows adding domain
- [ ] Tracking snippet page with copy button and install instructions
- [ ] Installation verification confirms snippet is firing
- [ ] Google Ads OAuth connection works end-to-end
- [ ] Success screen with summary before dashboard

## Tasks

<task id="05-01">
  <description>Create OnboardingWizard container</description>
  <file>frontend/src/pages/OnboardingWizard.tsx</file>
  <change>
    - Multi-step wizard with 4 steps:
      1. Account Setup (review/confirm)
      2. Site Setup (add domain)
      3. Snippet Installation (view code + verify)
      4. Platform Connection (Google Ads OAuth)
    - Progress indicator (stepper)
    - Can skip optional steps (platform connection)
    - Persist progress in localStorage (resume if interrupted)
    - On complete: show SuccessScreen
  </change>
</task>

<task id="05-02">
  <description>Create OnboardingStepper component</description>
  <file>frontend/src/components/OnboardingStepper.tsx</file>
  <change>
    - Props: currentStep, totalSteps, stepNames[]
    - Visual progress bar or numbered steps
    - Highlight current step
    - Show completed steps as checkmarks
    - Clickable to go back (optional)
  </change>
</task>

<task id="05-03">
  <description>Create Site Setup step</description>
  <file>frontend/src/components/onboarding/SiteSetupStep.tsx</file>
  <change>
    - Input field: Domain URL
    - Validation: Valid URL format
    - Check domain availability (not already in use)
    - "Add Site" button
    - Display added sites list (can add multiple if plan allows)
    - Call POST /api/v1/onboarding/site-setup
  </change>
</task>

<task id="05-04">
  <description>Implement site setup endpoint</description>
  <file>serverless/src/routes/onboarding.ts</file>
  <change>
    - POST /api/v1/onboarding/site-setup
    - Validate domain format
    - Check plan limits (Plan 03 middleware)
    - Create site record in D1 (sites table)
    - Generate unique tracking ID for site
    - Return { site_id, tracking_id }
  </change>
</task>

<task id="05-05">
  <description>Create Tracking Snippet step</description>
  <file>frontend/src/pages/SnippetPage.tsx</file>
  <change>
    - Display generated tracking snippet code
    - Syntax highlighting for JavaScript
    - Copy to Clipboard button
    - Platform-specific install instructions:
      - Shopify: Where to paste in theme.liquid
      - WooCommerce: Plugin or functions.php
      - Custom: <head> tag placement
    - Link to detailed docs
  </change>
</task>

<task id="05-06">
  <description>Create TrackingSnippet component</description>
  <file>frontend/src/components/TrackingSnippet.tsx</file>
  <change>
    - Props: trackingId, platform
    - Generate snippet code:
      ```html
      <script src="https://adsengineer.cloud/s.js?id=TRACKING_ID" async></script>
      ```
    - Copy button with feedback ("Copied!")
    - Code block with syntax highlighting
  </change>
</task>

<task id="05-07">
  <description>Create Installation Instructions component</description>
  <file>frontend/src/components/InstallInstructions.tsx</file>
  <change>
    - Props: platform (shopify|woocommerce|custom)
    - Platform-specific step-by-step instructions
    - Screenshots or diagrams (placeholder for now)
    - Expandable sections for detailed steps
  </change>
</task>

<task id="05-08">
  <description>Create snippet verification endpoint</description>
  <file>serverless/src/routes/onboarding.ts</file>
  <change>
    - POST /api/v1/onboarding/verify-snippet
    - Check if snippet has fired for this site
    - Query tracking_logs table for recent events
    - Return { installed: boolean, last_event_at? }
  </change>
</task>

<task id="05-09">
  <description>Create Verify Installation button</description>
  <file>frontend/src/components/VerifyInstallation.tsx</file>
  <change>
    - "Verify Installation" button
    - On click: call POST /api/v1/onboarding/verify-snippet
    - Show loading state
    - Success: "✓ Snippet detected!" with green checkmark
    - Failure: "Not detected yet" with troubleshooting tips
    - Auto-retry every 5 seconds for 2 minutes
  </change>
</task>

<task id="05-10">
  <description>Create Platform Connect step</description>
  <file>frontend/src/pages/PlatformConnect.tsx</file>
  <change>
    - List available platforms: Google Ads, Meta (disabled), TikTok (disabled)
    - Google Ads OAuth button
    - On click: initiate OAuth flow
    - Handle OAuth callback
    - Show connected status
    - Optional: can skip to dashboard
  </change>
</task>

<task id="05-11">
  <description>Implement Google Ads OAuth flow</description>
  <file>serverless/src/routes/platforms.ts</file>
  <change>
    - GET /api/v1/platforms/google-ads/auth
      - Generate OAuth URL with state param (CSRF protection)
      - Redirect to Google's OAuth consent screen
    - GET /api/v1/platforms/google-ads/callback
      - Verify state param
      - Exchange code for access_token + refresh_token
      - Encrypt tokens before storing in D1
      - Update user's platform_connections
      - Redirect to onboarding wizard with success param
  </change>
</task>

<task id="05-12">
  <description>Create encrypted credential storage</description>
  <file>serverless/src/services/encryption.ts</file>
  <change>
    - Use existing encryption service from project
    - Functions: encryptCredential(), decryptCredential()
    - Use AES-256-GCM
    - Key from Doppler (PLATFORM_ENCRYPTION_KEY)
  </change>
</task>

<task id="05-13">
  <description>Create Success Screen component</description>
  <file>frontend/src/components/onboarding/SuccessScreen.tsx</file>
  <change>
    - Celebration illustration/icon
    - "Setup Complete!" headline
    - Summary of what was configured:
      - ✓ Site: domain.com
      - ✓ Snippet: Installed
      - ✓ Platform: Google Ads connected
    - "Go to Dashboard" CTA button
    - "Add another site" secondary link
  </change>
</task>

<task id="05-14">
  <description>Add onboarding persistence</description>
  <file>frontend/src/hooks/useOnboarding.ts</file>
  <change>
    - Store current step in localStorage
    - Store completed steps
    - On mount: check if onboarding was started, resume
    - Clear localStorage on completion
  </change>
</task>

<task id="05-15">
  <description>Wire wizard to router</description>
  <file>frontend/src/App.tsx</file>
  <change>
    - Add route /onboarding
    - Wrap with ProtectedRoute
    - Check if user has completed onboarding, redirect if so
    - Or always show for now (simpler)
  </change>
</task>

<task id="05-16">
  <description>Add onboarding skip logic</description>
  <file>frontend/src/pages/OnboardingWizard.tsx</file>
  <change>
    - "Skip for now" button on optional steps (platform connect)
    - Confirm dialog: "You can connect platforms later from Settings"
    - Track skipped steps
  </change>
</task>

## Verification Criteria

- [ ] User can complete all 4 onboarding steps in <5 minutes
- [ ] Site setup creates site record in D1
- [ ] Snippet code displays with correct tracking ID
- [ ] Copy button copies code to clipboard
- [ ] Verification detects when snippet fires (test by installing on test site)
- [ ] Google Ads OAuth connects and stores encrypted credentials
- [ ] Success screen shows summary of configured items
- [ ] Onboarding progress persists if user refreshes page
- [ ] Can skip optional steps (platform connection)

## Dependencies

- Plan 01 (Auth Foundation) - Need JWT for user identification
- Plan 03 (Billing) - Plan limits for site count
- Plan 04 (Dashboard) - Link from success screen to dashboard

## Time Estimate

4-5 days
